# ============================================
# DENDRITE IDE - BUILD BOOK
# ============================================
# This file defines the incremental build eras for Dendrite IDE

meta:
  project: "dendrite-core"
  cats_ref: "docs/build/cats/dendrite-core.cats.yaml"
  total_eras: 4

# ============================================
# ERA 1: Rust/WASM Foundation
# ============================================
era_1:
  name: "Rust/WASM Foundation"
  description: "Core Rust workspace and WASM compilation infrastructure"
  assignee: "agent_1"
  status: "completed"
  completed_date: "2025-12-15"
  
  goals:
    - "Establish Rust workspace structure"
    - "Create dendrite_core crate with WASM compilation"
    - "Implement core data models (Session, StoredSession, GrowthProfile)"
    - "Set up WASM-bindgen exports for TypeScript interop"
    - "Create build scripts for WASM compilation"
    - "Verify WASM output and basic functionality"
  
  dependencies:
    external:
      - name: "rustc"
        version: ">=1.70.0"
        check: "rustc --version"
      - name: "cargo"
        version: ">=1.70.0"
        check: "cargo --version"
      - name: "wasm-pack"
        version: ">=0.12.0"
        check: "wasm-pack --version"
        install: "cargo install wasm-pack"
    
  structure:
    create:
      # Rust workspace root
      - path: "crates/"
        type: "directory"
        description: "Rust workspace root"
      
      - path: "crates/Cargo.toml"
        type: "file"
        template: "workspace_manifest"
        description: "Workspace manifest defining all crates"
      
      # dendrite_core crate
      - path: "crates/dendrite_core/"
        type: "directory"
        description: "Main WASM-compiled core engine"
      
      - path: "crates/dendrite_core/Cargo.toml"
        type: "file"
        template: "crate_manifest"
        description: "Crate manifest with dependencies"
      
      - path: "crates/dendrite_core/src/"
        type: "directory"
      
      - path: "crates/dendrite_core/src/lib.rs"
        type: "file"
        description: "Crate entry point, WASM exports"
        implements:
          - "WASM initialization"
          - "Export all public WASM functions"
          - "Module setup and configuration"
      
      - path: "crates/dendrite_core/src/session.rs"
        type: "file"
        description: "Session tracking logic"
        implements:
          - "Session struct"
          - "IdlePeriod struct"
          - "SessionState enum"
          - "Session lifecycle methods (start, pause, resume, end)"
          - "Keystroke and file edit tracking"
      
      - path: "crates/dendrite_core/src/storage.rs"
        type: "file"
        description: "Persistence structures"
        implements:
          - "StoredSession struct"
          - "SessionStats struct"
          - "GrowthProfile struct"
          - "DailyAggregate struct"
          - "LifetimeStats struct"
          - "Serialization/deserialization helpers"
      
      - path: "crates/dendrite_core/src/visualization.rs"
        type: "file"
        description: "Heatmap and chart data generation"
        implements:
          - "HeatmapCell struct"
          - "HeatmapData struct"
          - "LanguageStat struct"
          - "Heatmap generation algorithm"
          - "Hourly distribution calculation"
          - "Language breakdown calculation"
      
      - path: "crates/dendrite_core/src/git.rs"
        type: "file"
        description: "Git commit correlation"
        implements:
          - "CommitRef struct"
          - "Commit tracking functions"
          - "Session-commit correlation logic"
      
      - path: "crates/dendrite_core/src/export.rs"
        type: "file"
        description: "Portfolio export formats"
        implements:
          - "ExportOptions struct"
          - "ExportFormat enum"
          - "JSON export function"
          - "Markdown export function"
          - "SVG badge generation"
          - "Badge URL generation"
      
      # Build scripts
      - path: "scripts/build-dendrite.sh"
        type: "file"
        description: "WASM build and deployment script"
        implements:
          - "wasm-pack build command"
          - "Copy WASM to src/vs/workbench/contrib/dendrite/browser/"
          - "Build verification"
  
  tasks:
    - id: "1.1"
      name: "Create Rust workspace structure"
      status: "completed"
      files:
        - "crates/Cargo.toml"
      validation:
        - "cargo metadata succeeds"
        - "Workspace structure is valid"
    
    - id: "1.2"
      name: "Create dendrite_core crate manifest"
      status: "completed"
      depends_on: ["1.1"]
      files:
        - "crates/dendrite_core/Cargo.toml"
      validation:
        - "cargo check passes in dendrite_core"
        - "All dependencies resolve"
    
    - id: "1.3"
      name: "Implement core data models"
      status: "completed"
      depends_on: ["1.2"]
      files:
        - "crates/dendrite_core/src/session.rs"
        - "crates/dendrite_core/src/storage.rs"
        - "crates/dendrite_core/src/git.rs"
      validation:
        - "All structs compile"
        - "Serde serialization works"
    
    - id: "1.4"
      name: "Implement visualization data generation"
      status: "completed"
      depends_on: ["1.3"]
      files:
        - "crates/dendrite_core/src/visualization.rs"
      validation:
        - "Heatmap generation compiles"
        - "Language breakdown logic is correct"
    
    - id: "1.5"
      name: "Implement export functionality"
      status: "completed"
      depends_on: ["1.3"]
      files:
        - "crates/dendrite_core/src/export.rs"
      validation:
        - "All export formats work"
        - "JSON output is valid"
    
    - id: "1.6"
      name: "Set up WASM exports"
      status: "completed"
      depends_on: ["1.3", "1.4", "1.5"]
      files:
        - "crates/dendrite_core/src/lib.rs"
      validation:
        - "All wasm-bindgen exports are present"
        - "Function signatures match CATS spec"
    
    - id: "1.7"
      name: "Create WASM build script"
      status: "completed"
      depends_on: ["1.6"]
      files:
        - "scripts/build-dendrite.sh"
      validation:
        - "Script is executable"
        - "wasm-pack build succeeds"
        - "WASM artifacts are generated"
    
    - id: "1.8"
      name: "Test WASM build and verify output"
      status: "completed"
      depends_on: ["1.7"]
      validation:
        - "WASM module loads successfully"
        - "All exported functions are accessible"
        - "Basic smoke tests pass"
  
  artifacts:
    output:
      - "crates/dendrite_core/pkg/*.wasm"
      - "crates/dendrite_core/pkg/*.js"
      - "crates/dendrite_core/pkg/*.d.ts"
    
    verification:
      - command: "cargo test --package dendrite_core"
        description: "Run Rust unit tests"
      - command: "wasm-pack test --node"
        description: "Run WASM tests"
      - command: "ls -lh crates/dendrite_core/pkg/"
        description: "Verify WASM artifacts"

# ============================================
# ERA 2: VS Code Integration
# ============================================
era_2:
  name: "VS Code Integration Layer"
  description: "TypeScript services and VS Code contribution"
  assignee: "agent_2"
  status: "completed"
  completed_date: "2025-12-15"
  depends_on: ["era_1"]
  
  goals:
    - "Create VS Code contribution structure"
    - "Implement WASM bridge for TypeScript"
    - "Create service layer (storage, session lifecycle, git integration)"
    - "Register Growth view container"
    - "Implement basic dashboard webview"
  
  tasks:
    - id: "2.1"
      name: "Create contribution structure"
      status: "completed"
      files:
        - "src/vs/workbench/contrib/dendrite/browser/dendrite.contribution.ts"
        - "src/vs/workbench/contrib/dendrite/common/types.ts"
        - "src/vs/workbench/contrib/dendrite/common/constants.ts"
      validation:
        - "Contribution registers successfully"
        - "Types mirror CATS data models"
    
    - id: "2.2"
      name: "Implement WASM bridge"
      status: "completed"
      depends_on: ["2.1"]
      files:
        - "src/vs/workbench/contrib/dendrite/browser/wasmBridge.ts"
      validation:
        - "WASM loads from correct path (./wasm/)"
        - "JSON parsing wrapper works"
        - "All 23 WASM functions wrapped"
    
    - id: "2.3"
      name: "Create storage service"
      status: "completed"
      depends_on: ["2.2"]
      files:
        - "src/vs/workbench/contrib/dendrite/browser/storageService.ts"
      validation:
        - "Profile persists to global scope"
        - "Session handle persists to workspace scope"
    
    - id: "2.4"
      name: "Create session lifecycle service"
      status: "completed"
      depends_on: ["2.2", "2.3"]
      files:
        - "src/vs/workbench/contrib/dendrite/browser/sessionLifecycleService.ts"
      validation:
        - "Auto-start on editor activity"
        - "Idle detection working"
        - "Sessions saved on shutdown"
    
    - id: "2.5"
      name: "Create git integration service"
      status: "completed"
      depends_on: ["2.2"]
      files:
        - "src/vs/workbench/contrib/dendrite/browser/gitIntegrationService.ts"
      validation:
        - "Watches .git/HEAD for commits"
        - "Commits tracked to active session"
    
    - id: "2.6"
      name: "Register view container"
      status: "completed"
      depends_on: ["2.1"]
      files:
        - "src/vs/workbench/contrib/dendrite/browser/growthViewPaneContainer.ts"
      validation:
        - "Growth container appears in sidebar"
        - "Icon displays correctly"
    
    - id: "2.7"
      name: "Implement dashboard view"
      status: "completed"
      depends_on: ["2.4", "2.6"]
      files:
        - "src/vs/workbench/contrib/dendrite/browser/dashboardView.ts"
      validation:
        - "View shows session state"
        - "Updates on state changes"
  
  artifacts:
    output:
      - "src/vs/workbench/contrib/dendrite/browser/wasm/*.wasm"
      - "src/vs/workbench/contrib/dendrite/browser/wasm/*.js"
      - "src/vs/workbench/contrib/dendrite/**/*.ts"
    
    verification:
      - "WASM bridge loads successfully"
      - "Services instantiate without errors"
      - "View container registered"

# ============================================
# ERA 3: UI and Polish
# ============================================
era_3:
  name: "UI Implementation and Polish"
  description: "Visualization renderers, commands, and final integration"
  assignee: "agent_3"
  status: "not_started"
  depends_on: ["era_2"]
  
  goals:
    - "Implement all visualization renderers (heatmap, language chart, streak, commit timeline)"
    - "Implement all command handlers and register commands"
    - "Register and wire all settings with change listeners"
    - "Complete dashboard UI with all 6 sections and 8 components"
    - "Implement status bar integration"
    - "Apply remaining VS Code file mutations"
    - "Integrate WASM build into VS Code build process"
    - "Comprehensive integration testing and polish"
  
  phases:
    - name: "Phase 1: Renderer Infrastructure"
      description: "Create all visualization renderers"
      tasks: ["3.1", "3.2", "3.3", "3.4", "3.5"]
    
    - name: "Phase 2: Command Handlers"
      description: "Implement and register all commands"
      tasks: ["3.6", "3.7", "3.8", "3.9", "3.10"]
    
    - name: "Phase 3: Settings & Configuration"
      description: "Register settings and implement listeners"
      tasks: ["3.11", "3.12", "3.13"]
    
    - name: "Phase 4: Dashboard UI Components"
      description: "Complete all dashboard sections"
      tasks: ["3.14", "3.15", "3.16", "3.17", "3.18", "3.19"]
    
    - name: "Phase 5: Status Bar Integration"
      description: "Add session status to status bar"
      tasks: ["3.20"]
    
    - name: "Phase 6: VS Code Mutations"
      description: "Apply remaining file modifications"
      tasks: ["3.21", "3.22", "3.23", "3.24"]
    
    - name: "Phase 7: Build Integration"
      description: "Integrate WASM into build process"
      tasks: ["3.25"]
    
    - name: "Phase 8: Testing & Polish"
      description: "End-to-end testing and documentation"
      tasks: ["3.26", "3.27"]
  
  tasks:
    # ============================================
    # Phase 1: Renderer Infrastructure
    # ============================================
    - id: "3.1"
      name: "Create renderers directory structure"
      status: "not_started"
      phase: 1
      files:
        - "src/vs/workbench/contrib/dendrite/browser/renderers/"
      validation:
        - "Directory exists and is importable"
    
    - id: "3.2"
      name: "Implement heatmapRenderer.ts"
      status: "not_started"
      phase: 1
      depends_on: ["3.1"]
      files:
        - "src/vs/workbench/contrib/dendrite/browser/renderers/heatmapRenderer.ts"
      implements:
        - "HeatmapRenderer class"
        - "Calls WASM generate_heatmap(profile, weeks)"
        - "Renders HeatmapData as SVG or Canvas grid"
        - "Respects dendrite.heatmapWeeks setting"
        - "Interactive hover tooltips showing raw_minutes"
      validation:
        - "Renders 12 weeks by default"
        - "Updates when dendrite.heatmapWeeks changes"
        - "Handles empty data gracefully"
        - "Tooltips show date and activity duration"
    
    - id: "3.3"
      name: "Implement languageChartRenderer.ts"
      status: "not_started"
      phase: 1
      depends_on: ["3.1"]
      files:
        - "src/vs/workbench/contrib/dendrite/browser/renderers/languageChartRenderer.ts"
      implements:
        - "LanguageChartRenderer class"
        - "Calls WASM generate_language_breakdown(profile)"
        - "Renders Vec<LanguageStat> as pie or bar chart"
        - "Uses language_colors from constants"
        - "Fallback to 'other' color for unknown languages"
      validation:
        - "Colors match CATS specification"
        - "Percentages sum to 100%"
        - "Shows top N languages, groups rest as 'Other'"
        - "Renders correctly with 1 language or 10+ languages"
    
    - id: "3.4"
      name: "Implement streakRenderer.ts"
      status: "not_started"
      phase: 1
      depends_on: ["3.1"]
      files:
        - "src/vs/workbench/contrib/dendrite/browser/renderers/streakRenderer.ts"
      implements:
        - "StreakRenderer class"
        - "Displays current_streak and longest_streak from LifetimeStats"
        - "Uses WASM get_current_streak() and get_longest_streak()"
        - "Visual streak indicator (flame/fire icon with count)"
        - "Shows notification on streak increase if dendrite.showStreakNotification enabled"
      validation:
        - "Streak updates on new day with activity"
        - "Shows both current and longest streak"
        - "Notification appears when setting enabled"
        - "Visual indicator scales with streak length"
    
    - id: "3.5"
      name: "Implement commitTimelineRenderer.ts"
      status: "not_started"
      phase: 1
      depends_on: ["3.1"]
      files:
        - "src/vs/workbench/contrib/dendrite/browser/renderers/commitTimelineRenderer.ts"
      implements:
        - "CommitTimelineRenderer class"
        - "Calls WASM get_commit_correlations(profile)"
        - "Renders commit timeline with session correlation"
        - "Shows commit hash (short), message, timestamp"
        - "Links commit to session that included it"
        - "Shows files changed count"
      validation:
        - "Timeline shows chronological order"
        - "Clicking commit shows session details"
        - "Handles repos with no commits"
        - "Updates when new commits added"
    
    # ============================================
    # Phase 2: Command Handlers
    # ============================================
    - id: "3.6"
      name: "Create commands directory structure"
      status: "not_started"
      phase: 2
      files:
        - "src/vs/workbench/contrib/dendrite/browser/commands/"
      validation:
        - "Directory exists and is importable"
    
    - id: "3.7"
      name: "Implement exportCommand.ts"
      status: "not_started"
      phase: 2
      depends_on: ["3.6"]
      files:
        - "src/vs/workbench/contrib/dendrite/browser/commands/exportCommand.ts"
      implements:
        - "ExportPortfolioCommand class"
        - "Quick pick for format selection (JSON, Markdown, SVG Heatmap, Badge SVG, Badge URL)"
        - "Calls corresponding WASM export function based on selection"
        - "File save dialog for JSON/Markdown/SVG"
        - "Clipboard copy for Badge URL/Markdown"
        - "Success notification with file path or clipboard status"
      validation:
        - "All 5 export formats work"
        - "File saves to chosen location"
        - "Markdown and JSON are syntactically valid"
        - "SVG renders correctly in browser"
        - "Badge URL is accessible"
    
    - id: "3.8"
      name: "Implement badgeCommand.ts"
      status: "not_started"
      phase: 2
      depends_on: ["3.6"]
      files:
        - "src/vs/workbench/contrib/dendrite/browser/commands/badgeCommand.ts"
      implements:
        - "CopyBadgeCommand class"
        - "Calls WASM generate_badge_svg() or generate_badge_url()"
        - "Formats as markdown: ![Dendrite](url) or ![Dendrite](data:image/svg+xml,...)"
        - "Copies to clipboard using IClipboardService"
        - "Shows success notification"
      validation:
        - "Badge markdown is valid"
        - "Clipboard receives correct text"
        - "Badge displays current stats (streak, time, etc)"
        - "SVG or URL format works in GitHub markdown"
    
    - id: "3.9"
      name: "Implement session control commands"
      status: "not_started"
      phase: 2
      depends_on: ["3.6"]
      files:
        - "src/vs/workbench/contrib/dendrite/browser/commands/sessionCommands.ts"
      implements:
        - "PauseSessionCommand - calls sessionLifecycleService.pauseSession()"
        - "ResumeSessionCommand - calls sessionLifecycleService.resumeSession()"
        - "ShowStatsCommand - shows notification with today's stats"
        - "OpenGrowthCommand - focuses Growth view container"
      validation:
        - "Pause/resume changes session state correctly"
        - "Stats notification shows: time, keystrokes, files, languages"
        - "OpenGrowth focuses sidebar and Growth view"
        - "Commands respect dendrite.enabled setting"
    
    - id: "3.10"
      name: "Register all commands in contribution"
      status: "not_started"
      phase: 2
      depends_on: ["3.7", "3.8", "3.9"]
      files:
        - "src/vs/workbench/contrib/dendrite/browser/dendrite.contribution.ts"
      implements:
        - "Register dendrite.pauseSession"
        - "Register dendrite.resumeSession"
        - "Register dendrite.exportPortfolio"
        - "Register dendrite.copyBadge"
        - "Register dendrite.openGrowth with keybinding ctrl+shift+g"
        - "Register dendrite.showStats"
      validation:
        - "All 6 commands appear in command palette"
        - "Commands show correct titles from CATS"
        - "ctrl+shift+g keybinding works for openGrowth"
        - "Commands are enabled/disabled based on session state"
    
    # ============================================
    # Phase 3: Settings & Configuration
    # ============================================
    - id: "3.11"
      name: "Register settings schema"
      status: "not_started"
      phase: 3
      files:
        - "src/vs/workbench/contrib/dendrite/browser/dendrite.contribution.ts"
      implements:
        - "Register dendrite.enabled (boolean, default: true)"
        - "Register dendrite.idleThresholdMs (number, default: 300000)"
        - "Register dendrite.autoStart (boolean, default: true)"
        - "Register dendrite.trackGit (boolean, default: true)"
        - "Register dendrite.heatmapWeeks (number, default: 12)"
        - "Register dendrite.showStreakNotification (boolean, default: true)"
        - "JSON schema with types, defaults, descriptions from CATS"
      validation:
        - "All 6 settings appear in Settings UI"
        - "Settings show under 'Dendrite' category"
        - "Defaults match CATS specification exactly"
        - "Type validation prevents invalid values"
    
    - id: "3.12"
      name: "Implement settings change listeners"
      status: "not_started"
      phase: 3
      depends_on: ["3.11"]
      files:
        - "src/vs/workbench/contrib/dendrite/browser/settingsService.ts"
      implements:
        - "DendriteSettingsService class"
        - "Listen to IConfigurationService changes"
        - "dendrite.enabled → pause/resume sessionLifecycleService"
        - "dendrite.idleThresholdMs → update sessionLifecycleService threshold"
        - "dendrite.autoStart → affect session start behavior"
        - "dendrite.trackGit → enable/disable gitIntegrationService"
        - "dendrite.heatmapWeeks → refresh heatmap renderer"
        - "dendrite.showStreakNotification → control streak notifications"
      validation:
        - "Changing enabled immediately pauses/resumes tracking"
        - "Changing idleThresholdMs updates idle detection"
        - "Changing trackGit starts/stops git watcher"
        - "Changing heatmapWeeks re-renders heatmap"
        - "All changes take effect without restart"
    
    - id: "3.13"
      name: "Define language color constants"
      status: "not_started"
      phase: 3
      files:
        - "src/vs/workbench/contrib/dendrite/common/constants.ts"
      implements:
        - "LANGUAGE_COLORS constant map with 12 languages from CATS"
        - "typescript: #3178c6, javascript: #f7df1e, python: #3776ab"
        - "rust: #dea584, go: #00add8, java: #b07219"
        - "csharp: #239120, cpp: #f34b7d, ruby: #cc342d"
        - "swift: #fa7343, kotlin: #a97bff, other: #6e7681"
      validation:
        - "Colors match CATS specification exactly"
        - "Used by languageChartRenderer"
        - "Fallback to 'other' for unknown languages"
    
    # ============================================
    # Phase 4: Dashboard UI Components
    # ============================================
    - id: "3.14"
      name: "Implement dashboard header section"
      status: "not_started"
      phase: 4
      depends_on: ["3.7"]
      files:
        - "src/vs/workbench/contrib/dendrite/browser/dashboardView.ts"
      implements:
        - "Header section with session indicator"
        - "Shows ACTIVE/IDLE/PAUSED/ENDED state with icon"
        - "Export button triggers dendrite.exportPortfolio"
        - "Updates in real-time on session state changes"
      validation:
        - "Indicator shows correct state and icon"
        - "Export button works"
        - "UI updates immediately on state change"
        - "State transitions animate smoothly"
    
    - id: "3.15"
      name: "Implement dashboard streak section"
      status: "not_started"
      phase: 4
      depends_on: ["3.4"]
      files:
        - "src/vs/workbench/contrib/dendrite/browser/dashboardView.ts"
      implements:
        - "Streak section using StreakRenderer"
        - "Shows current streak and longest streak side-by-side"
        - "Visual flame/fire icon"
      validation:
        - "Streak displays correctly"
        - "Updates at midnight on new day"
        - "Shows 0 when no activity"
    
    - id: "3.16"
      name: "Implement dashboard today stats section"
      status: "not_started"
      phase: 4
      files:
        - "src/vs/workbench/contrib/dendrite/browser/dashboardView.ts"
      implements:
        - "Today's active time (formatted as Xh Ym)"
        - "Today's keystroke count"
        - "Today's files edited count"
        - "Today's languages used (top 3)"
      validation:
        - "Stats update in real-time during session"
        - "Time formats correctly (e.g., 2h 34m, 45m, 3s)"
        - "Resets at midnight"
        - "Shows 0/empty state gracefully"
    
    - id: "3.17"
      name: "Implement dashboard heatmap section"
      status: "not_started"
      phase: 4
      depends_on: ["3.2", "3.12"]
      files:
        - "src/vs/workbench/contrib/dendrite/browser/dashboardView.ts"
      implements:
        - "Heatmap section using HeatmapRenderer"
        - "Respects dendrite.heatmapWeeks setting"
        - "Shows GitHub-style activity grid"
      validation:
        - "Heatmap renders correctly"
        - "Tooltips show date and duration on hover"
        - "Updates when data changes"
        - "Updates when dendrite.heatmapWeeks setting changes"
    
    - id: "3.18"
      name: "Implement dashboard languages section"
      status: "not_started"
      phase: 4
      depends_on: ["3.3", "3.13"]
      files:
        - "src/vs/workbench/contrib/dendrite/browser/dashboardView.ts"
      implements:
        - "Languages section using LanguageChartRenderer"
        - "Uses language colors from constants"
        - "Shows percentages and time per language"
      validation:
        - "Chart renders with correct colors"
        - "Colors are consistent with CATS spec"
        - "Shows percentages that sum to 100%"
        - "Updates when language usage changes"
    
    - id: "3.19"
      name: "Implement dashboard git timeline tab"
      status: "not_started"
      phase: 4
      depends_on: ["3.5"]
      files:
        - "src/vs/workbench/contrib/dendrite/browser/dashboardView.ts"
      implements:
        - "Tab navigation for git section"
        - "Git tab using CommitTimelineRenderer"
        - "Only visible if dendrite.trackGit is enabled"
        - "Tab shows commit count badge"
      validation:
        - "Tab switches correctly"
        - "Timeline renders in tab panel"
        - "Hidden when dendrite.trackGit disabled"
        - "Badge shows correct commit count"
    
    # ============================================
    # Phase 5: Status Bar Integration
    # ============================================
    - id: "3.20"
      name: "Implement status bar item"
      status: "not_started"
      phase: 5
      depends_on: ["3.9"]
      files:
        - "src/vs/workbench/contrib/dendrite/browser/statusBarService.ts"
      implements:
        - "DendriteStatusBarService class"
        - "Status bar item: dendrite.sessionStatus"
        - "Alignment: StatusbarAlignment.RIGHT, Priority: 100"
        - "Shows session state icon and active time"
        - "Tooltip: 'Dendrite: Click for stats'"
        - "onClick triggers dendrite.showStats command"
      validation:
        - "Status bar item appears on right side"
        - "Shows correct state icon (active/idle/paused)"
        - "Active time updates every second when active"
        - "Clicking shows stats notification"
        - "Tooltip appears on hover"
    
    # ============================================
    # Phase 6: VS Code Mutations
    # ============================================
    - id: "3.21"
      name: "Apply remaining product.json mutations"
      status: "not_started"
      phase: 6
      files:
        - "product.json"
      implements:
        - "Verify removed: extensionsGallery (already done)"
        - "Verify removed: extensionAllowedBadgeProviders (already done)"
        - "Verify removed: AIF-* telemetry keys (already done)"
        - "Verify added: dendrite.enabled: true (already done)"
        - "Remove if exists: aiKey, msftInternalDomains, sendASmile"
      validation:
        - "product.json parses correctly"
        - "No JSON syntax errors"
        - "VS Code builds successfully"
        - "No telemetry endpoints remain"
    
    - id: "3.22"
      name: "Comment out Extensions view container"
      status: "not_started"
      phase: 6
      files:
        - "src/vs/workbench/contrib/extensions/browser/extensions.contribution.ts"
      implements:
        - "Comment out ViewContainer registration for Extensions"
        - "Add comment: // DENDRITE: Disabled - replaced by Growth view"
      validation:
        - "Extensions view container not registered"
        - "No runtime errors"
        - "Growth view appears in its place"
    
    - id: "3.23"
      name: "Verify Dendrite import in workbench.common.main.ts"
      status: "completed"
      phase: 6
      files:
        - "src/vs/workbench/workbench.common.main.ts"
      note: "Already completed in Era 2 - just verify present"
      validation:
        - "Import line exists: import 'vs/workbench/contrib/dendrite/browser/dendrite.contribution'"
        - "Dendrite loads on startup"
    
    - id: "3.24"
      name: "Verify telemetry service disabled"
      status: "completed"
      phase: 6
      files:
        - "src/vs/platform/telemetry/common/telemetryService.ts"
      note: "Already completed in Era 2 - just verify disabled"
      validation:
        - "Telemetry disabled or using NullTelemetryService"
        - "No telemetry events sent"
    
    # ============================================
    # Phase 7: Build Integration
    # ============================================
    - id: "3.25"
      name: "Integrate WASM build into VS Code build"
      status: "not_started"
      phase: 7
      files:
        - "build/gulpfile.vscode.js"
      implements:
        - "Add task to call scripts/build-dendrite.sh"
        - "Ensure WASM builds before TypeScript compilation"
        - "Copy WASM artifacts to src/vs/workbench/contrib/dendrite/browser/wasm/"
        - "Include WASM files in distribution package"
      validation:
        - "yarn watch builds WASM automatically"
        - "WASM files present in dist/output"
        - "wasmBridge loads WASM successfully at runtime"
        - "Build fails if WASM compilation fails"
    
    # ============================================
    # Phase 8: Testing & Polish
    # ============================================
    - id: "3.26"
      name: "End-to-end integration testing"
      status: "not_started"
      phase: 8
      depends_on: ["3.20", "3.25"]
      implements:
        - "Test complete user flow:"
        - "  1. Launch Dendrite IDE"
        - "  2. Session auto-starts on first edit"
        - "  3. Edit files → keystroke tracking works"
        - "  4. Make git commit → commit appears in timeline"
        - "  5. View dashboard → all 6 sections render"
        - "  6. Export portfolio → all formats work"
        - "  7. Change settings → immediate effect"
        - "  8. Session goes idle → state changes"
        - "  9. Resume activity → session resumes"
        - "  10. Close IDE → session saves"
        - "  11. Reopen IDE → data persists"
      validation:
        - "All features work together seamlessly"
        - "No runtime errors in console"
        - "Performance is acceptable (no lag)"
        - "Data persists correctly across restarts"
        - "Memory usage is reasonable"
    
    - id: "3.27"
      name: "Documentation and polish"
      status: "not_started"
      phase: 8
      depends_on: ["3.26"]
      files:
        - "src/vs/workbench/contrib/dendrite/README.md"
      implements:
        - "User guide: How to use Dendrite features"
        - "Developer guide: Architecture and contribution"
        - "Build instructions: WASM requirements"
        - "Troubleshooting: Common issues and solutions"
        - "Screenshots: Dashboard, heatmap, exports"
      validation:
        - "Documentation is clear and complete"
        - "Examples are accurate and tested"
        - "Screenshots are up-to-date"
        - "Links work correctly"
  
  artifacts:
    output:
      - "src/vs/workbench/contrib/dendrite/browser/renderers/*.ts"
      - "src/vs/workbench/contrib/dendrite/browser/commands/*.ts"
      - "src/vs/workbench/contrib/dendrite/browser/settingsService.ts"
      - "src/vs/workbench/contrib/dendrite/browser/statusBarService.ts"
      - "Modified product.json"
      - "Modified extensions.contribution.ts"
      - "Modified gulpfile for WASM build"
      - "src/vs/workbench/contrib/dendrite/README.md"
    
    verification:
      - "All 6 commands registered and working"
      - "All 6 settings registered and functional"
      - "All 4 renderers display correctly"
      - "All 6 dashboard sections complete"
      - "Status bar shows session state"
      - "Export generates valid files in all formats"
      - "WASM builds automatically with VS Code"
      - "No telemetry sent"
      - "Integration tests pass"
  
  completion_criteria:
    - "All 27 tasks completed"
    - "All CATS UI components implemented"
    - "All CATS commands implemented"
    - "All CATS settings implemented"
    - "Dashboard matches CATS dashboard_layout spec"
    - "End-to-end user flow works flawlessly"
    - "Documentation complete"

# ============================================
# ERA 4: Velocity - Terminal & UI Polish
# ============================================
era_4:
  name: "Velocity - Terminal & UI Polish"
  description: "Achieve Hyprland-like fluidity with smooth cursor, GPU acceleration, and minimal input latency"
  assignee: "agent_4"
  status: "not_started"
  depends_on: ["era_3"]
  
  goals:
    - "Implement smooth cursor with sub-frame interpolation"
    - "Force GPU acceleration for terminal rendering"
    - "Minimize input-to-render latency"
    - "Add cursor physics configuration"
    - "Achieve 60+ FPS terminal rendering"
  
  motivation: |
    Era 4 focuses on achieving exceptional UI fluidity inspired by Hyprland's
    window manager speed. The goal is sub-frame cursor latency with smooth
    interpolation independent of terminal grid updates.
    
    Key principle: Cursor movement should feel instant and buttery-smooth,
    never locked to terminal cell boundaries or refresh rates.
  
  tasks:
    - id: "4.1"
      name: "Scaffold terminal contribution structure"
      status: "not_started"
      files:
        - "src/vs/workbench/contrib/dendrite/browser/terminal/"
      implements:
        - "Create terminal subdirectory under dendrite contrib"
        - "Set up module structure for xterm.js integration"
      validation:
        - "Directory exists and is importable"
        - "Module structure follows VS Code patterns"
    
    - id: "4.2"
      name: "Implement SmoothCursorAddon"
      status: "not_started"
      depends_on: ["4.1"]
      files:
        - "src/vs/workbench/contrib/dendrite/browser/terminal/smoothCursorAddon.ts"
      implements:
        - "SmoothCursorAddon class implementing ITerminalAddon"
        - "Monitor xterm.onCursorMove events"
        - "Create high-performance floating DOM overlay (position: absolute)"
        - "Implement lerp (linear interpolation) for smooth movement"
        - "Use CSS transform: translate3d for GPU acceleration"
        - "Configurable physics: duration (ms) and easing function"
        - "Ghost cursor that leads actual terminal cursor"
      technical_details:
        animation_strategy: "requestAnimationFrame loop with lerp interpolation"
        dom_structure: "Overlay div with pointer-events: none"
        performance_target: "< 1ms overhead per frame"
        cursor_shape: "Match terminal cursor style (block/underline/bar)"
      validation:
        - "Cursor interpolation runs at 60+ FPS"
        - "No visual lag between keystroke and cursor movement"
        - "Cursor position lerps smoothly between grid cells"
        - "Performance overhead < 1ms per frame"
        - "Works with all cursor shapes"
    
    - id: "4.3"
      name: "Integrate with XtermTerminal"
      status: "not_started"
      depends_on: ["4.2"]
      files:
        - "src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts"
      implements:
        - "Import and load SmoothCursorAddon"
        - "Attach addon to xterm instance when dendrite.terminal.smoothCursor enabled"
        - "Configure WebGL renderer as default (force GPU acceleration)"
        - "Disable native cursor rendering when smooth cursor active"
        - "Pass configuration to addon (physics, easing)"
      validation:
        - "Smooth cursor loads automatically when enabled"
        - "Terminal uses WebGL renderer by default"
        - "Native cursor hidden when smooth cursor active"
        - "Configuration changes apply immediately"
    
    - id: "4.4"
      name: "Add terminal velocity settings"
      status: "not_started"
      depends_on: ["4.3"]
      files:
        - "src/vs/workbench/contrib/dendrite/browser/dendrite.contribution.ts"
      implements:
        - "Register dendrite.terminal.smoothCursor (boolean, default: true)"
        - "Register dendrite.terminal.cursorPhysics (object)"
        - "  - duration: number (milliseconds, default: 80)"
        - "  - easing: string (CSS easing, default: 'ease-out')"
        - "Register dendrite.terminal.forceGPU (boolean, default: true)"
        - "Register dendrite.terminal.targetFPS (number, default: 60)"
      validation:
        - "All 4 settings appear in Settings UI under 'Dendrite > Terminal'"
        - "Defaults match specification"
        - "Type validation works (number ranges, valid easing functions)"
    
    - id: "4.5"
      name: "Implement settings change listeners"
      status: "not_started"
      depends_on: ["4.4"]
      files:
        - "src/vs/workbench/contrib/dendrite/browser/terminal/terminalVelocityService.ts"
      implements:
        - "TerminalVelocityService class"
        - "Listen to configuration changes"
        - "Update SmoothCursorAddon physics on change"
        - "Toggle smooth cursor on/off dynamically"
        - "Reload terminal renderer when forceGPU changes"
      validation:
        - "Changing smoothCursor toggles feature immediately"
        - "Changing cursorPhysics updates interpolation feel"
        - "Changing forceGPU switches renderer without restart"
        - "No terminal flicker or artifacts on config change"
    
    - id: "4.6"
      name: "Input latency optimization audit"
      status: "not_started"
      depends_on: ["4.3"]
      implements:
        - "Profile input-to-render pipeline"
        - "Measure keystroke → terminal update → screen render latency"
        - "Identify and remove unnecessary async boundaries"
        - "Batch DOM updates where possible"
        - "Use passive event listeners for input"
        - "Optimize hot paths in cursor movement"
      validation:
        - "Input latency < 16ms (60 FPS target)"
        - "No forced reflows in input handler"
        - "Performance.mark measurements show improvement"
        - "Keystroke registration feels instant"
    
    - id: "4.7"
      name: "Visual smoothness testing"
      status: "not_started"
      depends_on: ["4.2", "4.5", "4.6"]
      implements:
        - "Create test terminal session with rapid cursor movement"
        - "Test scenarios:"
        - "  1. Rapid typing (sustained 100+ WPM)"
        - "  2. Vim navigation (hjkl rapid movement)"
        - "  3. Tab completion with long paths"
        - "  4. Syntax highlighting heavy files (large JSON/logs)"
        - "  5. Scrollback with active cursor"
        - "Record performance metrics"
        - "Visual comparison: smooth cursor ON vs OFF"
      validation:
        - "Smooth cursor maintains 60 FPS during all test scenarios"
        - "Visual inspection confirms fluid motion"
        - "No cursor stuttering or jank"
        - "Perceived latency matches Hyprland feel"
    
    - id: "4.8"
      name: "Documentation and configuration guide"
      status: "not_started"
      depends_on: ["4.7"]
      files:
        - "src/vs/workbench/contrib/dendrite/browser/terminal/README.md"
      implements:
        - "Technical documentation for SmoothCursorAddon"
        - "User guide for terminal velocity settings"
        - "Performance tuning guide"
        - "Comparison: standard vs smooth cursor"
        - "Troubleshooting: GPU acceleration issues"
      validation:
        - "Documentation explains smooth cursor concept clearly"
        - "Settings examples are accurate"
        - "Performance expectations documented"
  
  artifacts:
    output:
      - "src/vs/workbench/contrib/dendrite/browser/terminal/smoothCursorAddon.ts"
      - "src/vs/workbench/contrib/dendrite/browser/terminal/terminalVelocityService.ts"
      - "src/vs/workbench/contrib/dendrite/browser/terminal/README.md"
      - "Modified xtermTerminal.ts (smooth cursor integration)"
      - "Terminal velocity settings in contribution"
    
    verification:
      - "Smooth cursor renders at 60+ FPS"
      - "Input latency < 16ms"
      - "GPU acceleration active (verify in DevTools)"
      - "Cursor interpolation visibly smooth"
      - "All 4 terminal settings functional"
      - "No performance regression in terminal"
  
  performance_targets:
    cursor_interpolation_fps: 60
    input_latency_ms: 16
    frame_overhead_ms: 1
    gpu_acceleration: "mandatory"
    visual_smoothness: "Hyprland-equivalent"
  
  technical_implementation:
    smooth_cursor_algorithm: |
      class SmoothCursorAddon {
        private currentPos: {x: number, y: number} = {x: 0, y: 0};
        private targetPos: {x: number, y: number} = {x: 0, y: 0};
        private cursorElement: HTMLElement;
        
        activate(terminal: Terminal) {
          // Create overlay cursor
          this.cursorElement = document.createElement('div');
          this.cursorElement.className = 'smooth-cursor';
          this.cursorElement.style.cssText = `
            position: absolute;
            pointer-events: none;
            will-change: transform;
            transform: translate3d(0, 0, 0);
          `;
          
          // Monitor cursor moves
          terminal.onCursorMove(() => {
            this.targetPos = this.getTerminalCursorPosition();
          });
          
          // Interpolation loop
          this.animationLoop();
        }
        
        private animationLoop() {
          requestAnimationFrame(() => {
            // Lerp towards target
            const alpha = this.physics.duration / 1000 * 60; // Frame-independent
            this.currentPos.x += (this.targetPos.x - this.currentPos.x) * alpha;
            this.currentPos.y += (this.targetPos.y - this.currentPos.y) * alpha;
            
            // Update DOM (GPU accelerated)
            this.cursorElement.style.transform = 
              `translate3d(${this.currentPos.x}px, ${this.currentPos.y}px, 0)`;
            
            this.animationLoop();
          });
        }
      }
  
  completion_criteria:
    - "All 8 tasks completed"
    - "Smooth cursor achieves 60+ FPS"
    - "Input latency < 16ms measured"
    - "GPU acceleration verified active"
    - "Visual smoothness equivalent to Hyprland WM"
    - "Settings allow customization of cursor physics"
    - "No performance regression in standard terminal usage"
    - "Documentation complete with performance tuning guide"
